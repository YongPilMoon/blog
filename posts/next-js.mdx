---
title: 'Next.js Pre-rendering'
date: '2022-11-30'
description: 'Next.js에서 Pre-rendering이 무엇이고 어떻게 구현하는가'
---

## Next.js란?

Next.js는 편리한 웹 개발 경험을 제공하기 위해 Versel에서 개발한 React 프레임워크입니다. 서버사이드 렌더링, 라우트 프리패칭, 코드 스프리팅 등 웹 성능 향상을 위한 기법들을 기본적으로 제공하고 파일 기반 라우팅, 최적화된 Image 컴포넌트 등을 제공하여 빠른 웹 서비스를 손 쉽게 만들 수 있게 합니다. 또한 API routes를 통해 API를 개발할 수 있는 환경도 제공합니다.

<br />

## Pre-rendering

Next.js에서 모든 page는 Pre-rendering 됩니다. Pre-rendering이란 사용자가 요청한 페이지를 빌드 타임 혹은 요청 타임에 미리 랜더링 하여
레이아웃이 포함된 HTML을 내려주는 것 을 말합니다. Pre-redering을 사용하면 Javascript를 실행하지 못하는 검색엔진도 검색이 가능하게 되어
SEO(검색엔진 최적화)에 유리합니다. Next.js에서는 상황에 따라 렌더링 시점을 선택할 수 있도록 여러 방법을 제공합니다.

<br />
### 1. getServerSideProps
<br />
Next.js에서 서버사이드 렌더링(SSR) 적용 여부는 `getServerSideProps`라는 함수에 의해서
결정됩니다. 페이지에 getServerSideProps 함수가 정의 되어 있다면 Next.js에서는 그
페이지를 요청 시점에 렌더링합니다. getServerSideProps함수는 오직 서버에서만 실행되며
props를 리턴합니다. 리턴된 props는 같은 페이지의 컴포넌트의 props로 주입되어 화면을
렌더링하는데 사용됩니다. 이 과정에서 DB등 외부에서 필요한 데이터를 받아 props로 넘겨
줄 수 있습니다. 서버사이드는 요청시 매번 데이터 변경이 이루어져야하는 상황에 적합합니다.
예를 들면 상품리스트가 있을 수 있습니다.

<br />
<CodeBlock>
  {`
    function Page({data}) {
    // data 렌더...
    }

    // 모든 요청 시 이 함수는 호출 됩니다.
    export async function getServerSideProps() {
        // 외부 API로부터 데이터 Fetch
        const res = await fetch('https://.../data')
        const data = await res.json()

        // props로 Page 컴포넌트에 data 전달
        return { props: { data } }
    }

    export default Page

// 출처: next.js 공식 홈페이지
`}

</CodeBlock>

<br />
### 2. getStaticProps
<br />
Next.js에서는 빌드 시점에 페이지를 렌더링하는 SSG(Static Site Genration)을 제공합니다.
SSR의 단점으로 요청시 매번 새로운 데이터를 fetch하여 새로 렌더링해야 함으로 많은
요청이 있을 시에는 서버의 부화가 걸릴 수 있습니다. 이를 해결하기 위해 나온 기법이
SSG이고 Next.js에서는 가능하다면 SSG를 더 적극 사용하는 것을 권장하고 있습니다. 단
SSG는 빌드 타임에 랜더링이 이루어짐으로 요청시 마다 변경되어야하는 페이지 보다는
blog글 같이 자주 변경이 필요없는 페이지에 더 적합합니다. SSG 사용시 데이터를 주입하기위해서는
getStaticProps함수를 사용할 수 있습니다.
<br />
<CodeBlock>
  {`
    // 포스트는 getStaticProps() 함수로 빌드 타임에 채워집니다.
    function Blog({ posts }) {
      return (
        <ul>
          {posts.map((post) => (
            <li>{post.title}</li>
          ))}
        </ul>
      )
    }

    // 이 함수는 빌드 타임에 서버 사이드에서 호출 됩니다.
    // 클라이언트 사이드에서는 호출 될 수 없음으로 데이터 베이스 쿼리문까지 직접 넣어도 괜찮습니다.
    export async function getStaticProps() {
       // 외부 API를 통해 posts를 가져옵니다.
        const res = await fetch('https://.../posts')
        const posts = await res.json()

        // { props: { posts }}를 리턴하면 Blog 컴포넌트는 'posts'를 props로 받을 수 있습니다.
        return { props: { posts } }
    }

    export default Blog

// 출처: next.js 공식 홈페이지
`}

</CodeBlock>
<br />
### 3. getStaticPaths
<br />
